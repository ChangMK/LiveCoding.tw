/**
 * @author      OA Wu <comdan66@gmail.com>
 * @copyright   Copyright (c) 2017 OA Wu Design
 * @license     http://creativecommons.org/licenses/by-nc/2.0/tw/
 */

$(function () {
  var w = 50;
  var h = 8;

  var $bitmap = $('#bitmap').addClass ('w' + w).addClass ('h' + h).append (new Array (w * h).fill (0).map (function (t) {
    return $('<div />').addClass ('b' + 0).click (function () {
      $(this).attr ('class', 'b1');
    });
  }));
  var $unit = $bitmap.find ('>*');
  var chars = {
    '_1': ['00010010', '00111110', '00000010'],
    '_2': ['00101110', '00101010', '00111010'],
    '_3': ['00101010', '00101010', '00111110'],
    '_4': ['00111000', '00001000', '00111110'],
    '_5': ['00111010', '00101010', '00101110'],
    '_6': ['00111110', '00101010', '00101110'],
    '_7': ['00100000', '00100000', '00111110'],
    '_8': ['00111110', '00101010', '00111110'],
    '_9': ['00111010', '00101010', '00111110'],
    '_0': ['00111110', '00100010', '00111110'],
    '_a': ['00011110', '00101000', '00111110'],
    '_b': ['00111110', '00101010', '00010100'],
    '_c': ['00011100', '00100010', '00100010'],
    '_d': ['00111110', '00100010', '00011100'],
    '_e': ['00111110', '00101010', '00100010'],
    '_f': ['00111110', '00101000', '00101000'],
    '_g': ['00011100', '00100010', '00101110'],
    '_h': ['00111110', '00001000', '00111110'],
    '_i': ['00100010', '00111110', '00100010'],
    '_j': ['00000100', '00000010', '00111100'],
    '_k': ['00111110', '00001000', '00110110'],
    '_l': ['00111110', '00000010', '00000010'],
    '_m': ['00111110', '00010000', '00001000', '00010000', '00111110'],
    '_n': ['00111110', '00010000', '00001000', '00111110'],
    '_o': ['00011100', '00100010', '00100010', '00011100'],
    '_p': ['00111110', '00101000', '00110000'],
    '_q': ['00011100', '00100010', '00100010', '00011110', '00000010'],
    '_r': ['00111110', '00101000', '00110110'],
    '_s': ['00111010', '00101010', '00101110'],
    '_t': ['00100000', '00111110', '00100000'],
    '_u': ['00111110', '00000010', '00111110'],
    '_v': ['00111100', '00000010', '00111100'],
    '_w': ['00111100', '00000010', '00001100', '00000010', '00111100'],
    '_x': ['00110110', '00001000', '00110110'],
    '_y': ['00111010', '00001010', '00111100'],
    '_z': ['00100110', '00101010', '00110010'],
    '_{': ['00001000', '00110110', '01000001'],
    '_}': ['01000001', '00110110', '00001000'],
    '_(': ['00011100', '00100010'],
    '_)': ['00100010', '00011100'],
    '_[': ['00111110', '00100010'],
    '_]': ['00100010', '00111110'],
    '_!': ['00111010'],
    '_?': ['00100000', '00101010', '00110000'],
    '_@': ['00111100', '01000010', '01011010', '01001010', '00110000'],
    '_#': ['00100100', '01111110', '00100100', '00100100', '01111110', '00100100'],
    '_$': ['00111010', '01101011', '00101110'],
    '_%': ['00100110', '00001000', '00110010'],
    '_^': ['00100000', '01000000', '00100000'],
    '_&': ['00010100', '00101010', '00010100', '00000010'],
    '_*': ['00010100', '00001000', '00010100'],
    '_-': ['00001000', '00001000', '00001000'],
    '__': ['00000010', '00000010', '00000010'],
    '_=': ['00010100', '00010100', '00010100'],
    '_+': ['00001000', '00011100', '00001000'],
    '_/': ['00000110', '00001000', '00110000'],
    "_'": ['00110000'],
    "''": ['00110000', '00000000', '00110000'],
    '_<': ['00001000', '00010100', '00100010'],
    '_>': ['00100010', '00010100', '00001000'],
    '_:': ['00010100'],
    '_;': ['00000010', '00010100'],
    '_,': ['00000001', '00000010'],
    '_~': ['00001100', '00001000', '00000100', '00001100'],
    '_\\': ['00110000', '00001000', '00000110'],
  };

  function prependChar (c, offset) {
    if (typeof chars['_' + c.toLowerCase ()] === 'undefined') return;
    if (typeof offset === 'undefined') offset = 0;

    for (var k = 0; k < chars['_' + c.toLowerCase ()].length + 1; k++) {
      for (var i = w - 1; i >= 0; i--) {
        for (var j = h - 1; j >= 0; j--) {
          $unit.eq (i + j * w).attr ('class', i === 0 ? 'b0' : $unit.eq (i + j * w - 1).attr ('class'));
        }
      }
    }

    chars['_' + c.toLowerCase ()].forEach (function (t, i) {
      t.split ('').forEach (function (u, j) {
        $unit.eq ((i + offset) + j * w).attr ('class', 'b' + u);
      });
    });
  }

  function appendChar (c, offset) {
    if (typeof chars['_' + c.toLowerCase ()] === 'undefined') return;
    if (typeof offset === 'undefined') offset = 0;
    var l = chars['_' + c.toLowerCase ()].length;

    for (var k = 0; k < l + 1; k++) {
      for (var i = 0; i < w; i++) {
        for (var j = 0; j < h; j++) {

          $unit.eq (i + j * w).attr ('class', i + 1 == w ? 'b0' : $unit.eq (i + j * w + 1).attr ('class'));
        }
      }
    }
    chars['_' + c.toLowerCase ()].forEach (function (t, i) {
      t.split ('').forEach (function (u, j) {
        $unit.eq ((w - 1) + j * w - (l - i - 1) - offset).attr ('class', 'b' + u);
      });
    });
  }

  function ani (a) {
    var tmp = null;
    if (Array.isArray (a) && a.length) {
      tmp = a.shift ();
      tmp ();
      setTimeout (ani, 1000, a);
    } else if (typeof a === 'function') {
      a ();
      tmp = Array.prototype.slice.call (arguments);
      tmp.shift ();
      setTimeout (ani, 1000, tmp);
    } else {
      return;
    }
  }

  function appendStr (str) {
    str.split ('').forEach (function (t) { appendChar (t); });
  }

  function clear () {
    $unit.attr ('class', 'b0');
  }
  function showRightStr (str) {
    clear ();
    str.split ('').forEach (function (t) { appendChar (t); });
  }
  
  showRightStr ('abc');

  ani (function () {
    showRightStr ('123');
  }, function () {
    showRightStr ('wxyz');
  }, function () {
    showRightStr ('c');
  }, function () {
    showRightStr ('!?');
  });
});